---
layout: pints
title: Index
id: index
---

    <article>
      <h2>Choose Your Pub</h2>

      <section id="msg">
        <!-- Wird dynamisch befüllt -->
      </section>

      <section id="pub-list">
        <!-- Wird dynamisch befüllt -->
      </section>  

      <!-- div class="small-gap"></div -->

      <section id="mapid" style="min-width: 320px; max-width: 640px; width: 640px; height: 480px;">
        <!-- Wird dynamisch befüllt -->
      </section>
    </article>

    <script>
      $(document).ready(function() {
        var count = 5;
        var location = { status: null, latitude: null, longitude: null };
        get_location(location);

        setTimeout(function(){ 
          console.log(" stat: " + location.status + " lat: " + location.latitude + " lon: " + location.longitude);

          if(location.status == 0){
            $('#msg').html('');
            var msg = "<p>Navigation is NOT availaible. <br>Please check GPS-support!</p>";
            $('#msg').append(msg);
            return false;
          }

          if(location.status == 1){
            $('#msg').html('');
            var msg = "<p>You have denied geolocation prompt. <br>Pints assumes the center of the city as your current location!</p>";
            $('#msg').append(msg);
            count = 10;
            location.latitude = 48.2083537;
            location.longitude = 16.3725042;
          }

          show_pubs(location, count);

          var mymap = L.map('mapid').setView([location.latitude, location.longitude], 13);

          L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
            maxZoom: 18,
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
                '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                'Imagery © <a href="http://mapbox.com">Mapbox</a>',
              id: 'mapbox.streets'
          }).addTo(mymap);

          $.getJSON('/data/pubs.json', function(data){
            var rpubs = new Array();

            $.each(data, function(index, pub){
              var distance = calc_distance(location.longitude, location.latitude, pub.longitude, pub.latitude);
              rpubs.push([distance, pub]);
            });

            function compare_distance(a, b){
              if(a[0] < b[0]) return -1;
              if(a[0] > b[0]) return 1;
              return 0;
            };

            rpubs.sort(compare_distance);

            var cnt = 0;            
            for(let rpub of rpubs){
              cnt += 1;
              if(cnt <= count){
                var pub = rpub[1];

                var pub1 = L.marker([pub.latitude, pub.longitude]).addTo(mymap);
                var popup = cnt.toString() + ") &nbsp;"
                popup += pub.name + ", ";
                for(category in pub.categories){
                  popup += category + " ";
                }
                popup += pub.address;
                if(pub.tel.length > 0){
                  popup += "<br>" + pub.tel;
                }
                if(pub.open.length > 0){
                  popup += "<br>" + pub.open;
                }

                pub1.bindPopup(popup);
              }
            }
            var userlocation = L.marker([location.latitude, location.longitude]).addTo(mymap);
            userlocation.bindPopup("Here you are!").openPopup();
        });
      }, 3000); 
    });
  </script>
